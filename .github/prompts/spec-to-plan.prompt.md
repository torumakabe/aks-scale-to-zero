---
mode: "agent"
description: "新機能追加または既存コードのリファクタリングの実装プランを生成する"
---

このプロンプトは、新機能追加または既存コードのリファクタリングの実装プランを生成するためのものです。
コードの編集は行わず、プランのみを生成してください。

実装プランファイルは [plan.md](../../docs/plan.md) です。

プランは以下のセクションを含む Markdown ドキュメントで構成されます。

- Overview: 機能またはリファクタリングタスクの簡潔な説明。
- Requirements: 機能またはリファクタリングタスクの要件リスト。
- Implementation Steps: 機能またはリファクタリングタスクを実装するための詳細なステップ。
  - 各ステップには以下を含める：
    - **実装内容**: 何を実装するかの詳細
    - **確認方法**: 実装を検証するための具体的なコマンドや手順
    - **期待される結果**: 成功時に期待される出力や動作
- Testing: 全体テストのリスト。

## 実装プラン作成・更新の手順

1. **既存ファイルの確認**：

   - 実装プランファイル [plan.md](../../docs/plan.md) が既に存在する場合は、必ず最初に内容を確認してください
   - ファイルが存在しない場合は、新規作成してください
   - 既存コードベースの状況を把握するため、src/ tests/ infra/ ディレクトリを調査してください

2. **差分の特定**：

   - 仕様ファイル [spec.md](../../docs/spec.md) の内容を確認してください
   - [spec.md](../../docs/spec.md) が存在しない場合は、ユーザーに要件を確認してください
   - 新機能追加、リファクタリングの対象は、仕様と既存コードの差分です

3. **編集方針**：

   - 既存の実装プランがある場合は、既存内容に追記・修正のみ行い、全体置換は避けてください
   - ステップの内容や順番に大幅な変更があり、追記や軽微な編集にとどまらない場合は、編集方針を確認してください
   - 大幅な変更が必要な場合は、変更内容の概要を先に提示し、ユーザーの承認を得てください
   - 変更履歴が把握しにくい大幅な変更の場合には、プロジェクトルートに archive フォルダを作成し、既存の実装プランを保存するなどの提案をしてください

4. **ステップの設計**：
   - 各ステップは小さく保ち（目安：1 つのファイルまたは 1 つの機能に対する変更）、1 つの課題にフォーカスしてください
   - それぞれのステップの実装状況を明記、更新してください（例：✅ 実装済み、⚠️ 部分的に実装済み、❌ 未実装）
   - **重要**: 各ステップは独立してテスト・確認できる単位とし、以下を必ず含めてください：
     - **実装内容**: 具体的に何を実装するか
     - **確認方法**: 実装が正しいことを確認するコマンドや手順
     - **期待される結果**: 確認時に期待される出力や動作
